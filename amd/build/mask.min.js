define ("profilefield_masked/mask",["jquery"],function(a){return function Mask(b,c,d){var f={invalid:[],getCaret:function getCaret(){try{var a,c=0,d=b.get(0),e=document.selection,g=d.selectionStart;if(e&&-1===navigator.appVersion.indexOf("MSIE 10")){a=e.createRange();a.moveStart("character",-f.val().length);c=a.text.length}else if(g||"0"===g){c=g}return c}catch(a){}},setCaret:function setCaret(a){try{if(b.is(":focus")){var c,d=b.get(0);if(d.setSelectionRange){d.setSelectionRange(a,a)}else{c=d.createTextRange();c.collapse(!0);c.moveEnd("character",a);c.moveStart("character",a);c.select()}}}catch(a){}},events:function events(){b.on("keydown.mask",function(a){b.data("mask-keycode",a.keyCode||a.which);b.data("mask-previus-value",b.val());b.data("mask-previus-caret-pos",f.getCaret());f.maskDigitPosMapOld=f.maskDigitPosMap}).on("keyup.mask",f.behaviour).on("paste.mask drop.mask",function(){setTimeout(function(){b.keydown().keyup()},100)}).on("change.mask",function(){b.data("changed",!0)}).on("blur.mask",function(){if(h!==f.val()&&!b.data("changed")){b.trigger("change")}b.data("changed",!1)}).on("blur.mask",function(){h=f.val()}).on("focus.mask",function(b){if(!0===d.selectOnFocus){a(b.target).select()}}).on("focusout.mask",function(){if(d.clearIfNotMatch){f.val("")}})},destroyEvents:function destroyEvents(){b.off("input.mask keydown.mask keyup.mask paste.mask drop.mask blur.mask focusout.mask ")},val:function val(a){var c=b.is("input"),d=c?"val":"text",e;if(0<arguments.length){if(b[d]()!==a){b[d](a)}e=b}else{e=b[d]()}return e},calculateCaretPosition:function calculateCaretPosition(a){var c=f.getMasked(),d=f.getCaret();if(a!==c){var e=b.data("mask-previus-caret-pos")||0,g=c.length,h=a.length,j=0,k=0,l=0,m=0,n=0;for(n=d;n<g;n++){if(!f.maskDigitPosMap[n]){break}k++}for(n=d-1;0<=n;n--){if(!f.maskDigitPosMap[n]){break}j++}for(n=d-1;0<=n;n--){if(f.maskDigitPosMap[n]){l++}}for(n=e-1;0<=n;n--){if(f.maskDigitPosMapOld[n]){m++}}if(d>h){d=10*g}else if(e>=d&&e!==h){if(!f.maskDigitPosMapOld[d]){var o=d;d-=m-l;d-=j;if(f.maskDigitPosMap[d]){d=o}}}else if(d>e){d+=l-m;d+=k}}return d},behaviour:function behaviour(c){c=c||window.event;f.invalid=[];var d=b.data("mask-keycode");if(-1===a.inArray(d,g.byPassKeys)){var h=f.getMasked(),i=f.getCaret(),j=b.data("mask-previus-value")||"";setTimeout(function(){f.setCaret(f.calculateCaretPosition(j))},a.jMaskGlobals.keyStrokeCompensation);f.val(h);f.setCaret(i);return f.callbacks(c)}},getMasked:function getMasked(a,b){var e=[],h=b===void 0?f.val():b+"",i=0,j=c.length,k=0,l=h.length,n=1,o="push",p=-1,q=0,r=[],s,t;if(d.reverse){o="unshift";n=-1;s=0;i=j-1;k=l-1;t=function(){return-1<i&&-1<k}}else{s=j-1;t=function(){return i<j&&k<l}}var u;while(t()){var w=c.charAt(i),x=h.charAt(k),y=g.translation[w];if(y){if(x.match(y.pattern)){e[o](x);if(y.recursive){if(-1===p){p=i}else if(i===s&&i!==p){i=p-n}if(s===p){i-=n}}i+=n}else if(x===u){q--;u=void 0}else if(y.optional){i+=n;k-=n}else if(y.fallback){e[o](y.fallback);i+=n;k-=n}else{f.invalid.push({p:k,v:x,e:y.pattern})}k+=n}else{if(!a){e[o](w)}if(x===w){r.push(k);k+=n}else{u=w;r.push(k+q);q++}i+=n}}var z=c.charAt(s);if(j===l+1&&!g.translation[z]){e.push(z)}var A=e.join("");f.mapMaskdigitPositions(A,r,l);return A},mapMaskdigitPositions:function mapMaskdigitPositions(a,b,c){var e=d.reverse?a.length-c:0;f.maskDigitPosMap={};for(var g=0;g<b.length;g++){f.maskDigitPosMap[b[g]+e]=1}},callbacks:function callbacks(a){var e=f.val(),g=e!==h,i=[e,a,b,d],j=function(a,b,c){if("function"==typeof d[a]&&b){d[a].apply(this,c)}};j("onChange",!0==g,i);j("onKeyPress",!0==g,i);j("onComplete",e.length===c.length,i);j("onInvalid",0<f.invalid.length,[e,a,b,f.invalid,d])}};b=a(b);var g=this,h=f.val();c="function"==typeof c?c(f.val(),void 0,b,d):c;g.mask=c;g.options=d;g.remove=function(){var a=f.getCaret();if(g.options.placeholder){b.removeAttr("placeholder")}if(b.data("mask-maxlength")){b.removeAttr("maxlength")}f.destroyEvents();f.val(g.getCleanVal());f.setCaret(a);return b};g.getCleanVal=function(){return f.getMasked(!0)};g.getMaskedVal=function(a){return f.getMasked(!1,a)};g.init=function(e){e=e||!1;d=d||{};g.clearIfNotMatch=a.jMaskGlobals.clearIfNotMatch;g.byPassKeys=a.jMaskGlobals.byPassKeys;g.translation=a.extend({},a.jMaskGlobals.translation,d.translation);g=a.extend(!0,{},g,d);if(e){f.events();f.val(f.getMasked())}else{if(d.placeholder){b.attr("placeholder",d.placeholder)}if(b.data("mask")){b.attr("autocomplete","off")}for(var h=0,j=!0,k;h<c.length;h++){k=g.translation[c.charAt(h)];if(k&&k.recursive){j=!1;break}}if(j){b.attr("maxlength",c.length).data("mask-maxlength",!0)}f.destroyEvents();f.events();var l=f.getCaret();f.val(f.getMasked());f.setCaret(l)}};g.init(!b.is("input"))}});
//# sourceMappingURL=mask.min.js.map
